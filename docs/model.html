---

title: Model


keywords: fastai
sidebar: home_sidebar

summary: "Temporal dilated convolutional model."
description: "Temporal dilated convolutional model."
nb_path: "nbs/00_model.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_model.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TemporalModelBase" class="doc_header"><code>class</code> <code>TemporalModelBase</code><a href="https://github.tifx04-22-10.com/TIFX04-22-10/runningpose/tree/master/runningpose/core/model.py#L9" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TemporalModelBase</code>(<strong><code>num_joints_in</code></strong>, <strong><code>in_features</code></strong>, <strong><code>num_joints_out</code></strong>, <strong><code>filter_witdhs</code></strong>, <strong><code>causal</code></strong>, <strong><code>dropout</code></strong>, <strong><code>channels</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Do not instantiate this class. This class is for inheritance.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TemporalModelBase</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Do not instantiate this class. This class is for inheritance.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">num_joints_in</span><span class="p">,</span> <span class="n">in_features</span><span class="p">,</span> 
            <span class="n">num_joints_out</span><span class="p">,</span> <span class="n">filter_witdhs</span><span class="p">,</span> <span class="n">causal</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Validate filter (Kernals) witdh input.</span>
        <span class="k">for</span> <span class="n">fw</span> <span class="ow">in</span> <span class="n">filter_witdhs</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">fw</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Only odd filter widths are supported.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_joints_in</span> <span class="o">=</span> <span class="n">num_joints_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_features</span> <span class="o">=</span> <span class="n">in_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_joints_out</span> <span class="o">=</span> <span class="n">num_joints_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_widths</span> <span class="o">=</span> <span class="n">filter_witdhs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
        
        <span class="c1"># Makes output the same size as the input after going through filter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_witdhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>  

        <span class="bp">self</span><span class="o">.</span><span class="n">expand_bn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">shrink</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">num_joints_out</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">set_bn_momentum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">momentum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the batch norm momentum and updates the </span>
<span class="sd">        corresponding layers where it is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand_bn</span><span class="o">.</span><span class="n">momentum</span> <span class="o">=</span> <span class="n">momentum</span>
        <span class="k">for</span> <span class="n">bn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_bn</span><span class="p">:</span> 
            <span class="n">bn</span><span class="o">.</span><span class="n">momentum</span> <span class="o">=</span> <span class="n">momentum</span>

    <span class="k">def</span> <span class="nf">receptive_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the total receptive field of this model as number of frames.&quot;&quot;&quot;</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">+=</span> <span class="n">f</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">frames</span>

    <span class="k">def</span> <span class="nf">total_causal_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the asymmetric offset for sequence padding.</span>
<span class="sd">        The returned value is typically 0 if causal convolutions are </span>
<span class="sd">        disabled, otherwise it is half the receptive field.</span>
<span class="sd">        Causal convolutions ensures the model cannot violate the </span>
<span class="sd">        ordering in which we model the temporal data. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">causal_shift</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">next_dilation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_widths</span><span class="p">)):</span>
            <span class="n">frames</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">causal_shift</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">next_dilation</span>
            <span class="n">next_dilation</span> <span class="o">*=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">frames</span>

    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_joints_in</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_features</span>

        <span class="n">sz</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_blocks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_joints_out</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TemporalModel" class="doc_header"><code>class</code> <code>TemporalModel</code><a href="https://github.tifx04-22-10.com/TIFX04-22-10/runningpose/tree/master/runningpose/core/model.py#L82" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TemporalModel</code>(<strong><code>num_joints_in</code></strong>, <strong><code>in_features</code></strong>, <strong><code>num_joints_out</code></strong>, <strong><code>filter_widths</code></strong>, <strong><code>causal</code></strong>=<em><code>False</code></em>, <strong><code>dropout</code></strong>=<em><code>0.25</code></em>, <strong><code>channels</code></strong>=<em><code>1024</code></em>, <strong><code>dense</code></strong>=<em><code>False</code></em>) :: <a href="/runningpose/model.html#TemporalModelBase"><code>TemporalModelBase</code></a></p>
</blockquote>
<p>3D pose estimation model with temporal convolutions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TemporalModel</span><span class="p">(</span><span class="n">TemporalModelBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;3D pose estimation model with temporal convolutions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">num_joints_in</span><span class="p">,</span> <span class="n">in_features</span><span class="p">,</span> <span class="n">num_joints_out</span><span class="p">,</span> <span class="n">filter_widths</span><span class="p">,</span> 
            <span class="n">causal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">dense</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the temporal model.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        num_joints_in -- Number of input joints to our model. </span>
<span class="sd">        in_features -- Number of input features for each joint.</span>
<span class="sd">        num_joints_out -- Number of output joints (can be different than input).</span>

<span class="sd">        filter_widths -- List of convolutions, </span>
<span class="sd">            which also determines the number of blocks and receptive field.</span>

<span class="sd">        causal -- Use causal convolutions instead of symmetric </span>
<span class="sd">            convolutions (for real-time applications).</span>
<span class="sd">    </span>
<span class="sd">        dropout -- Dropout probability.</span>
<span class="sd">        channels -- Number of convolution channels.</span>

<span class="sd">        dense -- Use regular dense convolutions instead of dilated </span>
<span class="sd">            convolutions (ablation experiment).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">num_joints_in</span><span class="p">,</span> <span class="n">in_features</span><span class="p">,</span> <span class="n">num_joints_out</span><span class="p">,</span> 
                         <span class="n">filter_widths</span><span class="p">,</span> <span class="n">causal</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>                  
        <span class="bp">self</span><span class="o">.</span><span class="n">expand_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">num_joints_in</span><span class="o">*</span><span class="n">in_features</span><span class="p">,</span> 
                                     <span class="n">channels</span><span class="p">,</span> <span class="n">filter_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">causal_shift</span> <span class="o">=</span> <span class="p">[(</span><span class="n">filter_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">causal</span> <span class="k">else</span> <span class="mi">0</span><span class="p">]</span> 

        <span class="c1"># Initialize and build layers and the stores them in a list.</span>
        <span class="n">layers_conv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">layers_bn</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">next_dilation</span> <span class="o">=</span> <span class="n">filter_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_widths</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pad</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">filter_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">next_dilation</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">causal_shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">filter_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">*</span> <span class="n">next_dilation</span><span class="p">)</span> <span class="k">if</span> <span class="n">causal</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">layers_conv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span>
                <span class="n">channels</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> 
                <span class="n">filter_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">dense</span> <span class="k">else</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pad</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">dilation</span><span class="o">=</span><span class="n">next_dilation</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">dense</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

            <span class="n">layers_bn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>
            <span class="n">layers_conv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span>
                <span class="n">channels</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="n">layers_bn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>

            <span class="n">next_dilation</span> <span class="o">*=</span> <span class="n">filter_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Add to a ModuleList that holds submodules visible by all Module methods.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">layers_conv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers_bn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">layers_bn</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_forward_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_bn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_conv</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">causal_shift</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">pad</span> <span class="o">+</span> <span class="n">shift</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pad</span> <span class="o">+</span> <span class="n">shift</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layers_bn</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">layers_conv</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">))))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layers_bn</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">layers_conv</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">](</span><span class="n">x</span><span class="p">))))</span>
        
        <span class="c1"># Fits the last layer so that it matches our output preferences.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

